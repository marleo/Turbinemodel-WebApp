{% extends "base.html" %}

{% block title %}Other Page{% endblock %}

{% block head %}
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wind Turbine Model Scaler ‚Äî Plug & Play</title>
  <style>
    body {
      font-family: "Inter", system-ui, sans-serif;
      margin: 24px;
      color: #1c2534;
      background: linear-gradient(180deg, #f7faff 0%, #eef2f8 100%);
    }

    h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.6rem;
      text-align: center;
      color: #0b3d91;
    }

    h3 {
      font-size: 1.15rem;
      margin-bottom: 12px;
      color: #2b3a55;
    }

    .muted {
      color: #5a6475;
      font-size: 0.95rem;
      text-align: center;
      max-width: 650px;
      margin: 0 auto 20px;
    }

    #out table {
      width: auto;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    #out th,
    #out td {
      padding: 6px 14px;
      text-align: center;
      white-space: nowrap;
    }


    .input-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      margin-top: 24px;
    }

    .card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
      border: 1px solid #e4e8ef;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.08);
    }

    .inputcard {
      background: #fbfcfe;
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: 500;
      font-size: 0.9rem;
      color: #374151;
    }

    input {
      padding: 10px 12px;
      margin-top: 5px;
      width: 100%;
      border: 1px solid #d0d7e2;
      border-radius: 10px;
      box-sizing: border-box;
      font-size: 0.95rem;
      background: #fff;
      transition: border 0.2s ease, box-shadow 0.2s ease;
    }

    input:focus {
      border-color: #528eff;
      outline: none;
      box-shadow: 0 0 0 3px rgba(82, 142, 255, 0.2);
    }

    button {
      margin-top: 28px;
      padding: 12px 22px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, #0b69ff, #528eff);
      color: white;
      font-size: 1.05rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(11, 105, 255, 0.3);
      transition: all 0.2s ease;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    button:hover {
      background: linear-gradient(135deg, #0958d9, #4075e8);
      transform: translateY(-2px);
    }

    #out {
      margin-top: 24px;
    }

    #out .card {
      background: #ffffff;
      border-left: 5px solid #0b69ff;
    }

    #out h4 {
      font-size: 1.05rem;
      font-weight: 600;
      margin-bottom: 10px;
    }

    #out h4.real {
      color: #2e7d32;
    }

    #out h4.model {
      color: #1565c0;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 12px;
      font-size: 0.9rem;
      border-radius: 8px;
      overflow: hidden;
    }

    th,
    td {
      border: 1px solid #e3e6ea;
      padding: 8px;
      text-align: center;
    }

    .flex-columns {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
    }

    .flex-columns .col {
      flex: 1;
      min-width: 250px;
    }

    .highlight {
      display: inline-block;
      background: #eef4ff;
      color: #0b3d91;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 1rem;
      border: 1px solid #d6e4ff;
    }

    th {
      background: #f0f4fa;
      font-weight: 600;
      color: #344054;
    }
  </style>
{% endblock %}
{% block content %}
<body>
  <h1>‚öôÔ∏è Wind Turbine Model Scaler</h1>
  <p class="muted">Enter the <em>real</em> turbine parameters and the <em>model</em> specs. The tool calculates model
    distance, model RPM, and blur estimates for given shutter speeds. Defaults set for a 1.0 m radius model and a Sony
    A9 III.</p>

  <div class="input-grid">
    <div class="card inputcard">
      <h3><u>Real turbine</u></h3>
      <label>Rotor radius (m) ‚Äî <small>e.g. 40‚Äì100+ (leave blank for 50)</small></label>
      <input id="r_real" type="number" step="any" placeholder="50" />
      <label>Tip speed (km/h)</label>
      <input id="v_tip_real" type="number" value="150" />
      <label>Shooting distance to rotor center (m)</label>
      <input id="R_real" type="number" value="75" />
    </div>

    <div class="card inputcard">
      <h3><u>Model (3D-printed turbine)</u></h3>
      <label>Model rotor radius (m)</label>
      <input id="r_model" type="number" value="1" />
    </div>

    <div class="card inputcard">
      <h3><u>Camera / sensor</u></h3>
      <label>Focal length (mm)</label>
      <input id="f_mm" type="number" value="100" />
      <label>Pixel pitch (¬µm)</label>
      <input id="pixel_pitch" type="number" value="5.94" />
      <label>Desired maximum blur at tip (pixels)</label>
      <input id="blur_px_target" type="number" value="2" />
    </div>
  </div>

  <button id="run">Compute model settings</button>

  <div id="out" style="margin-top:16px"></div>

  <div id="formulae" class="card">
    <h3>üìê Formulae Used (with units)</h3>
    <div class="formulae-block">
      <p>Angular speed: <span class="var">œâ = v<sub>tip</sub> / r</span> (rad/s, v<sub>tip</sub> in m/s, r in m)</p>
      <p>Model RPM: <span class="var">RPM = œâ ¬∑ 60 / (2œÄ)</span> (rev/min, œâ in rad/s)</p>
      <p>Scaled shooting distance: <span class="var">R<sub>model</sub> = R<sub>real</sub> ¬∑ (r<sub>model</sub> /
          r<sub>real</sub>)</span> (m)</p>
      <p>Image-plane speed: <span class="var">v<sub>img</sub> = v ¬∑ f / R</span> (m/s; v in m/s, f in m, R in m)</p>
      <p>Pixel blur (in pixels): <span class="var">blur<sub>px</sub> = (v<sub>img</sub> ¬∑ t) / p</span> (px;
        v<sub>img</sub> in m/s, t in s, p in m)</p>
      <p>Required shutter: <span class="var">t = (blur<sub>target</sub> ¬∑ p) / v<sub>img</sub></span> (s;
        blur<sub>target</sub> in px, p in m, v<sub>img</sub> in m/s)</p>
      <p>Notes: f in meters, pixel pitch p in meters, v<sub>tip</sub> converted to m/s from km/h.</p>
    </div>
  </div>
  <script>
    function compute() {
      // =============================
      // üîπ INPUT PARAMETERS
      // =============================

      // Camera parameters
      const f_mm = Number(document.getElementById('f_mm').value) || 100; // focal length in mm
      const pixel_pitch_um = Number(document.getElementById('pixel_pitch').value) || 5.86; // pixel pitch in ¬µm
      const blur_px_target = Number(document.getElementById('blur_px_target').value) || 2; // allowable blur in pixels

      // Real turbine parameters
      const r_real = Number(document.getElementById('r_real').value) || 50; // real blade radius [m]
      const v_tip_real_kmh = Number(document.getElementById('v_tip_real').value) || 150; // real tip speed [km/h]
      const R_real = Number(document.getElementById('R_real').value) || 75; // shooting distance [m]

      // Model turbine parameters
      const r_model = Number(document.getElementById('r_model').value) || 1; // model blade radius [m]

      // =============================
      // üîπ PHYSICS CALCULATIONS
      // =============================

      // Convert input units
      const f_m = f_mm / 1000; // focal length in meters
      const v_real = v_tip_real_kmh / 3.6; // real tip speed [m/s]
      const omega = v_real / r_real; // angular velocity [rad/s] (same for real & model)
      const v_model = omega * r_model; // tip speed of model [m/s]
      const rpm_model = (omega * 60) / (2 * Math.PI); // model rotation speed [RPM]

      // Effective shooting distance for model (scaled with radius)
      const R_model = R_real * (r_model / r_real);

      // =============================
      // üîπ IMAGE PLANE VELOCITIES
      // =============================

      // Project tip velocity onto image plane
      const vimg_real = (v_real * f_m) / R_real; // image-plane speed of real tip [m/s]
      const vimg_model = (v_model * f_m) / R_model; // image-plane speed of model tip [m/s]

      // Pixel pitch in meters
      const p_m = pixel_pitch_um * 1e-6;

      // Helper: compute blur in pixels for given exposure time
      function blur_px(vimg, t) {
        return (vimg * t) / p_m;
      }

      // Required shutter times (so blur ‚â§ target)
      const t_needed_real = (blur_px_target * p_m) / vimg_real;
      const t_needed_model = (blur_px_target * p_m) / vimg_model;

      // =============================
      // üîπ BLUR TABLE FOR COMMON SHUTTERS
      // =============================

      const shutters = [
        1 / 30, 1 / 60, 1 / 125, 1 / 250,
        1 / 500, 1 / 1000, 1 / 2000,
        1 / 4000, 1 / 8000, 1 / 16000
      ];

      const isoMapping = {
        "1/30": "ISO 100",
        "1/60": "ISO 100",
        "1/125": "ISO 100",
        "1/250": "ISO 200",
        "1/500": "ISO 400",
        "1/1000": "ISO 800",
        "1/2000": "ISO 1600",
        "1/4000": "ISO 3200",
        "1/8000": "ISO 6400",
        "1/16000": "ISO 12800"
      };

      let tableRows = '';
      for (const s of shutters) {
        const frac = formatFraction(s);
        const b = blur_px(vimg_model, s);
        tableRows += `<tr>
            <td>${frac}</td>
            <td>${isoMapping[frac] || "-"}</td>
            <td>${b.toFixed(2)}</td>
        </tr>`;
      }

      // =============================
      // üîπ OUTPUT FORMATTING
      // =============================

      document.getElementById('out').innerHTML = `
        <div class="card">
          <h3>üìä Calculated Settings</h3>
          <div class="flex-columns">
            <div class="col">
              <h4><u>Real turbine</u></h4>
              <p><strong>Shooting distance:</strong> ${R_real.toFixed(3)} m</p>
              <p><strong>Tip speed:</strong> ${v_real.toFixed(3)} m/s</p>
              <p><strong>Angular speed:</strong> ${omega.toFixed(4)} rad/s</p>
              <p><strong>Image-plane speed:</strong> ${(vimg_real * 1000).toFixed(2)} mm/s</p>
              <p><strong>Required shutter (‚â§ ${blur_px_target} px blur):</strong> <span class="highlight"> ${formatFraction(t_needed_real)} s (${(t_needed_real * 1000).toFixed(3)} ms)</p>
            </div>
            <div class="col">
              <h4><u>Model turbine</u></h4>
              <p><strong>Shooting distance:</strong> <span class="highlight"> ${R_model.toFixed(2)} m</p>
              <p><strong>Tip speed:</strong> ${v_model.toFixed(3)} m/s</p>
              <p><strong>Angular speed:</strong> ${omega.toFixed(4)} rad/s</p>
              <p><strong>Set model RPM to:</strong> <span class="highlight">${rpm_model.toFixed(2)} RPM</span></p>
              <p><strong>Image-plane speed:</strong> ${(vimg_model * 1000).toFixed(2)} mm/s</p>
              <p><strong>Required shutter (‚â§ ${blur_px_target} px blur):</strong> <span class="highlight"> ${formatFraction(t_needed_model)} s (${(t_needed_model * 1000).toFixed(3)} ms)</p>
            </div>
          </div>

          <!-- <h4>Blur table (tip) for common shutter speeds</h4> -->
          <table>
            <thead><tr><th>Shutter</th><th>ISO (Sunny 16 - 1/100 - ISO 100 - f/16)</th><th>Blur at tip (px)</th></tr></thead>
            <tbody>
            ${tableRows}
            </tbody>
          </table>
        </div>
      `;
    }

    function formatFraction(s) {
      if (s >= 1) return `${s.toFixed(3)} s`;
      if (s < 1 / 30000) return s.toExponential(2);
      const inv = Math.round(1 / s);
      return `1/${inv}`;
    }

    // Run on button click and at load
    document.getElementById('run').onclick = compute;
    compute();
  </script>
{% endblock %}