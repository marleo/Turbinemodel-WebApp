{% extends "base.html" %}

{% block title %}YOLO Wind Turbine â€” Upload & Process{% endblock %}

{% block head %}
<style>
/* Keep all your previous styles that were inside <style> in index.html */
h1 { margin-bottom: 8px; }
form { margin: 16px 0; }
.card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; }
.btn:disabled { opacity:0.5; cursor:not-allowed; }
.hint { color:#6b7280; font-size:14px; }
video, img { width:100%; max-height:70vh; border-radius:12px; border:4px solid #212aad; }
.grid { display:grid; grid-template-columns:1fr; gap:16px; }
@media (min-width:900px) { .grid { grid-template-columns:1fr 1fr; } }
#webcam-feed { display:none; }
#model-select { padding:8px 12px; border-radius:8px; border:1px solid #ccc; font-size:14px; margin-right:8px; background:#f3f4f6; cursor:pointer; }
#model-select:focus { outline:none; border-color:#212aad; box-shadow:0 0 0 2px rgba(33,42,173,0.3); }
.btn { background:#212aad; color:#fff; border:0; padding:8px 14px; border-radius:8px; cursor:pointer; font-size:14px; }
.btn:hover { background:#1e26b0; }
</style>
{% endblock %}

{% block content %}
<h1>Live/Offline Segmentation Tool</h1>
<p class="hint">Upload a video or start a live webcam feed to see the tracking in action.</p>
<div class="card">
    <select id="model-select" onchange="switchModel()">
        <option value="v8" selected>YOLOv8</option>
        <option value="v11n">YOLOv11n</option>
        <option value="v11s">YOLOv11s</option>
    </select>
    <p id="model-status" style="margin-top:8px; font-size:14px; color:#333;">Active Model: V8</p>
</div>

<div class="card" style="margin-top:16px;">
    <form method="post" enctype="multipart/form-data" action="{{ url_for('main.index') }}">
        <input type="file" name="file" accept="video/*" required>
        <button class="btn" type="submit">Upload & Process Video</button>
    </form>
    <div class="hint">Allowed: mp4/mov/avi/mkv. Model runs offline on the server.</div>
</div>

<div class="card" style="margin-top:16px;">
    <p style="margin:0 0 16px 0;">Live Webcam Tracking:</p>
    <button class="btn" onclick="startWebcam()">Start Live Feed</button>
</div>

<img id="webcam-feed" src="">

{% if video_url %}
<h2>Processed Video</h2>
<video controls autoplay loop muted playsinline width="640">
    <source src="{{ video_url }}" type="video/mp4">
</video>
<p><a class="btn" href="{{ video_url }}" download>Download processed file</a></p>
{% endif %}

<script>
function startWebcam() {
    document.getElementById('webcam-feed').style.display = 'block';
    document.getElementById('webcam-feed').src = "{{ url_for('main.webcam_feed') }}";
}

function switchModel() {
    const model = document.getElementById("model-select").value;
    fetch(`/set_model/${model}`);
    const statusEl = document.getElementById("model-status");
    if (statusEl) statusEl.textContent = `Active Model: ${model.toUpperCase()}`;
}
</script>
{% endblock %}
